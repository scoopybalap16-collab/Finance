<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catatan Piutang & Utang Modern</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="style.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <meta name="theme-color" content="#4e73df">
</head>
<body>

    <div class="side-menu-modal" id="sideMenuModal">
        <div class="side-menu-content" id="sideMenuContent">
            <div class="side-menu-header">
                <h3>Finance Tracker <span class="version-tag">v2.0</span></h3>
            </div>
            
            <div class="menu-item active" data-page="homePage">
                <i class="fas fa-home"></i> Beranda
            </div>
            <div class="menu-item" data-page="activeLoansPage">
                <i class="fas fa-handshake"></i> Daftar Pinjaman Aktif
            </div>
            <div class="menu-item" data-page="historyPage">
                <i class="fas fa-history"></i> Riwayat Pembayaran (Lunas)
            </div>
            <div class="menu-item" data-page="summaryPage">
                <i class="fas fa-chart-line"></i> Ringkasan Total
            </div>
            <div class="menu-item" data-page="backupPage">
                <i class="fas fa-database"></i> Export & Import Data
            </div>
            <div class="menu-item" data-page="formPage">
                <i class="fas fa-plus-circle"></i> Tambah Catatan Baru
            </div>
            <div class="menu-item" data-page="aboutPage">
                <i class="fas fa-info-circle"></i> Tentang Aplikasi
            </div>
            
            <div class="menu-footer">
                <p>Status Notifikasi: <span id="notificationStatusText">Memuat...</span></p>
                <button onclick="requestNotificationPermission()">Aktifkan Izin</button>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </div>
        <h1 id="pageTitle">Beranda</h1>
    </div>

    <div class="main-content">
        
        <div class="page active" id="homePage">
            <div class="dashboard-section">
                <h2>Ringkasan Keuangan Aktif</h2>
                <div class="summary-dashboard" id="mainDashboard">
                    <p style="text-align: center; color: var(--text-muted);">Memuat...</p>
                </div>
            </div>

            <div class="dashboard-section">
                <h2>Distribusi Total Pinjaman (Awal)</h2>
                <div class="chart-container">
                    <canvas id="loanChart"></canvas>
                </div>
            </div>

            <div class="dashboard-section">
                <h2>Jatuh Tempo Mendekat</h2>
                <div id="latestTransactions">
                     <p style="text-align: center; color: var(--text-muted);">Tidak ada transaksi aktif yang mendekati jatuh tempo.</p>
                </div>
            </div>
        </div>

        <div class="page" id="activeLoansPage">
            <h2>Daftar Pinjaman Aktif</h2>
            <div class="list-controls">
                 <input type="text" id="searchLoans" placeholder="Cari nama atau deskripsi..." onkeyup="filterTransactionList('active')">
                 <select id="filterLoans" onchange="filterTransactionList('active')">
                     <option value="all">Semua (Piutang & Utang)</option>
                     <option value="piutang">Hanya Piutang (Klaim)</option>
                     <option value="utang">Hanya Utang (Kewajiban)</option>
                 </select>
            </div>
            <div id="activeLoansList">
                <p style="text-align: center; color: var(--text-muted); padding: 20px 0;">Memuat data pinjaman aktif...</p>
            </div>
        </div>

        <div class="page" id="historyPage">
            <h2>Riwayat Transaksi Lunas</h2>
            <div class="list-controls">
                 <input type="text" id="searchHistory" placeholder="Cari nama..." onkeyup="filterTransactionList('history')">
                 <select id="sortHistory" onchange="filterTransactionList('history')">
                     <option value="lunas_desc">Tanggal Lunas (Terbaru)</option>
                     <option value="principal_desc">Pokok Awal (Terbesar)</option>
                 </select>
            </div>
            <div id="historyList">
                <p style="text-align: center; color: var(--text-muted); padding: 20px 0;">Memuat riwayat lunas...</p>
            </div>
        </div>
        
        <div class="page" id="summaryPage">
            <h2>Ringkasan Total Keuangan</h2>
            <div class="summary-page-content">

                <div class="summary-block card-piutang">
                    <h3>Total Piutang (Klaim)</h3>
                    <div class="summary-row">
                        <span>Total Awal (Pokok + Bunga):</span>
                        <strong id="summaryPiutangAwal">Rp 0</strong>
                    </div>
                    <div class="summary-row">
                        <span>Sisa Piutang Aktif (Termasuk Denda):</span>
                        <strong style="color: var(--success-color);" id="summaryPiutangSisa">Rp 0</strong>
                    </div>
                </div>

                <div class="summary-block card-utang">
                    <h3>Total Utang (Kewajiban)</h3>
                    <div class="summary-row">
                        <span>Total Awal (Pokok + Bunga):</span>
                        <strong id="summaryUtangAwal">Rp 0</strong>
                    </div>
                    <div class="summary-row">
                        <span>Sisa Utang Aktif (Termasuk Denda):</span>
                        <strong style="color: var(--danger-color);" id="summaryUtangSisa">Rp 0</strong>
                    </div>
                </div>

                <div class="summary-block card-networth">
                    <h3>Net Worth (Nilai Bersih)</h3>
                    <div class="summary-row networth">
                        <span>Net Worth Akhir (Piutang Sisa - Utang Sisa):</span>
                        <strong id="summaryNetWorth">Rp 0</strong>
                    </div>
                </div>

                <button onclick="exportToCSV()" class="export-button">
                     <i class="fas fa-file-csv"></i> Export Semua Data ke CSV (Excel)
                </button>
            </div>
        </div>

        <div class="page" id="backupPage">
             <h2>Backup & Restore Data</h2>
             <p class="info">Semua data tersimpan lokal. Backup JSON secara berkala untuk keamanan.</p>
             <div class="summary-dashboard">
                 <div class="summary-card card-networth">
                     <h3>Jumlah Transaksi Tersimpan</h3>
                     <p id="totalTransactionsCount">0 Transaksi</p>
                 </div>
                 <div class="summary-card card-networth">
                     <h3>Tanggal Backup Terakhir</h3>
                     <p id="lastBackupDate">Belum Ada</p>
                 </div>
             </div>

             <div class="backup-section">
                 <h2>Opsi Data</h2>
                 <div class="button-group">
                     <button id="export-btn" class="btn-success"><i class="fas fa-file-download"></i> Backup Data (JSON)</button>
                     <button id="trigger-import-btn" class="btn-primary"><i class="fas fa-file-upload"></i> Restore Data (JSON)</button>
                     <input type="file" id="import-file" accept="application/json">
                     <button onclick="clearAllData()" class="btn-danger"><i class="fas fa-trash-alt"></i> Hapus Semua Data</button>
                 </div>
             </div>
        </div>

        <div class="page" id="formPage">
            <h2>Tambah Catatan Baru</h2>
            <form id="transactionForm">

                <div class="form-group">
                    <label for="type"><i class="fas fa-exchange-alt"></i> Tipe Transaksi</label>
                    <select id="type" required>
                        <option value="piutang">Piutang (Saya Memberi Pinjaman/Klaim)</option>
                        <option value="utang">Utang (Saya Meminjam/Kewajiban)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="person"><i class="fas fa-user-circle"></i> Nama Pihak Lain</label>
                    <input type="text" id="person" placeholder="Nama..." required>
                </div>

                <div class="form-group">
                    <label for="principal"><i class="fas fa-wallet"></i> Pokok Pinjaman (Rp)</label>
                    <input type="text" id="principal" placeholder="Misal: 1.000.000" oninput="formatInputRupiah(this); updateInstallmentEstimate();" required>
                </div>

                <div class="form-group">
                    <label for="interestRate"><i class="fas fa-percent"></i> Bunga (%) per Periode</label>
                    <input type="number" id="interestRate" step="0.01" value="0" oninput="updateInstallmentEstimate()" required>
                    <div class="form-info">Bunga Flat (persen dari Pokok) dikali Tenor. Misal: 1% flat/bulan.</div>
                </div>

                 <div class="form-group">
                    <label for="installmentsCount"><i class="fas fa-calendar-alt"></i> Tenor / Jumlah Cicilan (Bulan)</label>
                    <input type="number" id="installmentsCount" value="1" min="1" oninput="updateInstallmentEstimate(); calculateDueDate();" required>
                    <div class="form-info">Input 1 jika lunas 1x bayar.</div>
                </div>

                <div class="form-group">
                    <label for="startDate"><i class="fas fa-calendar-day"></i> Tanggal Mulai / Dibuat</label>
                    <input type="date" id="startDate" oninput="calculateDueDate()" required>
                    <div class="form-info">Jatuh tempo cicilan akan mengikuti tanggal ini (misal: tgl 15 setiap bulan).</div>
                </div>

                <div class="form-group estimate-box" id="installmentEstimate" style="display: none;">
                     </div>

                <div class="form-group">
                    <label for="finalDueDateDisplay"><i class="fas fa-calendar-check"></i> Estimasi Jatuh Tempo Terakhir</label>
                    <p id="finalDueDateDisplay" class="due-display-text"></p>
                </div>

                <button type="submit" class="submit-button"><i class="fas fa-save"></i> Simpan Transaksi Baru</button>
            </form>
        </div>

        <div class="page" id="aboutPage">
            <div class="about-section">
                <h2>Tentang</h2>
                <p class="info">Aplikasi catatan keuangan dengan fungsi utama sebagai pencatat tentang hutang & piutang, serta menerapkan bunga pinjaman flat dan denda majemuk</p>
                
                <div class="about-card">
                    <h3>Versi Aplikasi</h3>
                    <p>2.0 - Modern UI/UX & Compounding Fine Logic</p>
                </div>

                <div class="about-card">
                    <h3>Pencipta</h3>
                    <p class="created-by">Created by Eximouse</p>
                </div>
            </div>
        </div>

    </div>

    <div class="fab" id="fabAddTransaction" onclick="navigateTo('formPage')">
        <i class="fas fa-plus"></i>
    </div>

    <div id="transactionDetailModal" class="modal">
        <div class="modal-content-detail">
            <span class="close-btn" onclick="closeDetailModal()">&times;</span>
            <div class="modal-title" id="modalTitle"></div>
            <div id="modalContent"></div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>
    
    <div id="paymentDateModal" class="modal">
        <div class="modal-content-payment">
            <h3><i class="fas fa-cash-register"></i> Catat Pembayaran</h3>
            <div id="paymentAmountDisplay" class="payment-due-box"></div>
            <div class="form-group" style="margin-top: 20px;">
                <label for="datePaidInput"><i class="fas fa-calendar-check"></i> Tanggal Pembayaran:</label>
                <input type="date" id="datePaidInput" required>
            </div>
            
            <div class="form-group">
                <label for="nominalPaidInput"><i class="fas fa-hand-holding-usd"></i> Nominal Dibayar:</label>
                <input type="text" id="nominalPaidInput" placeholder="Masukkan jumlah bayar..." oninput="formatInputRupiah(this)" required>
                <div class="form-info">Nominal akan otomatis terisi dengan jumlah tagihan. Isi jika bayar lebih/kurang.</div>
            </div>

            <div class="payment-modal-actions">
                <button class="btn-secondary" onclick="closePaymentModal()">Batal</button>
                <button id="confirmPaymentBtn" class="btn-success">Konfirmasi Bayar</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
